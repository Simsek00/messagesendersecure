<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profil - Secure Message System</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="dashboard-body">
    <div class="dashboard-container">
        <!-- Header -->
        <header class="dashboard-header">
            <div class="header-left">
                <h1>ğŸ‘¤ Profil AyarlarÄ±</h1>
                <p class="username-display"><strong>{{ user.username }}</strong></p>
            </div>
            <div class="header-right">
                <a href="/dashboard" class="btn btn-secondary">â† Dashboard'a DÃ¶n</a>
                <a href="/logout" class="btn btn-logout">Ã‡Ä±kÄ±ÅŸ Yap</a>
            </div>
        </header>

        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages">
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }}">
                            {{ message }}
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <!-- Main Content -->
        <div class="profile-content">
            <!-- User Information Card -->
            <div class="card profile-info-card">
                <h2>ğŸ“‹ Hesap Bilgileri</h2>
                
                <div class="info-grid">
                    <div class="info-item">
                        <span class="info-label">ğŸ‘¤ KullanÄ±cÄ± AdÄ±:</span>
                        <span class="info-value">{{ user.username }}</span>
                    </div>
                    
                    <div class="info-item">
                        <span class="info-label">ğŸ“… KayÄ±t Tarihi:</span>
                        <span class="info-value">{{ user.created_at }}</span>
                    </div>
                    
                    <div class="info-item">
                        <span class="info-label">ğŸ“¤ GÃ¶nderilen Mesaj:</span>
                        <span class="info-value">{{ user.sent_count }}</span>
                    </div>
                    
                    <div class="info-item">
                        <span class="info-label">ğŸ“¥ AlÄ±nan Mesaj:</span>
                        <span class="info-value">{{ user.received_count }}</span>
                    </div>
                </div>
            </div>

            <!-- Change Password Card -->
            <div class="card change-password-card">
                <h2>ğŸ”‘ Åifre DeÄŸiÅŸtir</h2>
                
                <form method="POST" action="/change_password" class="profile-form">
                    <div class="form-group">
                        <label for="current_password">Mevcut Åifre</label>
                        <input 
                            type="password" 
                            id="current_password" 
                            name="current_password" 
                            placeholder="Mevcut ÅŸifrenizi girin"
                            required
                            minlength="6">
                    </div>

                    <div class="form-group">
                        <label for="new_password">Yeni Åifre</label>
                        <input 
                            type="password" 
                            id="new_password" 
                            name="new_password" 
                            placeholder="Yeni ÅŸifrenizi girin"
                            required
                            minlength="6">
                        <small>Minimum 6 karakter (gÃ¼Ã§lÃ¼ ÅŸifre kullanÄ±n)</small>
                    </div>

                    <div class="form-group">
                        <label for="confirm_password">Yeni Åifre (Tekrar)</label>
                        <input 
                            type="password" 
                            id="confirm_password" 
                            name="confirm_password" 
                            placeholder="Yeni ÅŸifrenizi tekrar girin"
                            required
                            minlength="6">
                    </div>

                    <button type="submit" class="btn btn-primary">ğŸ” Åifreyi DeÄŸiÅŸtir</button>
                </form>
            </div>

            <!-- Danger Zone Card -->
            <div class="card danger-zone-card">
                <h2>âš ï¸ Tehlikeli BÃ¶lge</h2>
                <p class="danger-warning">
                    Bu iÅŸlem geri alÄ±namaz! HesabÄ±nÄ±z ve tÃ¼m mesajlarÄ±nÄ±z kalÄ±cÄ± olarak silinecektir.
                </p>
                
                <button class="btn btn-danger" onclick="showDeleteAccountModal()">
                    ğŸ—‘ï¸ HesabÄ± KalÄ±cÄ± Olarak Sil
                </button>
            </div>
        </div>

        <!-- Footer -->
        <footer class="dashboard-footer">
            <p>ğŸ›¡ï¸ Secure Coding & Scripting Languages Project</p>
            <p><small>Mustafa Ã–zcan, Mehmet Okur, Mehmet Arhan Efe, TÃ¼rkay AydoÄŸan</small></p>
        </footer>
    </div>

    <!-- Delete Account Confirmation Modal -->
    <div id="deleteAccountModal" class="modal">
        <div class="modal-content">
            <h2>ğŸš¨ HesabÄ± Sil</h2>
            <p class="danger-text">
                <strong>DÄ°KKAT!</strong> Bu iÅŸlem geri alÄ±namaz!
            </p>
            <p>
                HesabÄ±nÄ±zÄ± silmek istediÄŸinizden emin misiniz?<br>
                TÃ¼m mesajlarÄ±nÄ±z ve kullanÄ±cÄ± bilgileriniz kalÄ±cÄ± olarak silinecektir.
            </p>
            
            <form method="POST" action="/delete_account" id="deleteAccountForm">
                <div class="form-group">
                    <label for="confirm_password_delete">Åifrenizi Girin (Onay Ä°Ã§in)</label>
                    <input 
                        type="password" 
                        id="confirm_password_delete" 
                        name="confirm_password" 
                        placeholder="Åifrenizi girin"
                        required>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn btn-cancel" onclick="closeDeleteAccountModal()">
                        Ä°ptal
                    </button>
                    <button type="submit" class="btn btn-danger">
                        Evet, HesabÄ±mÄ± Sil
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        function showDeleteAccountModal() {
            document.getElementById('deleteAccountModal').style.display = 'flex';
        }

        function closeDeleteAccountModal() {
            document.getElementById('deleteAccountModal').style.display = 'none';
            document.getElementById('deleteAccountForm').reset();
        }

        // Modal dÄ±ÅŸÄ±na tÄ±klanÄ±rsa kapat
        window.onclick = function(event) {
            const modal = document.getElementById('deleteAccountModal');
            if (event.target === modal) {
                closeDeleteAccountModal();
            }
        }

        // ESC tuÅŸu ile modal'Ä± kapat
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeDeleteAccountModal();
            }
        });

        // Åifre eÅŸleÅŸme kontrolÃ¼ (client-side)
        document.getElementById('confirm_password')?.addEventListener('input', function() {
            const newPass = document.getElementById('new_password').value;
            const confirmPass = this.value;
            
            if (confirmPass && newPass !== confirmPass) {
                this.setCustomValidity('Åifreler eÅŸleÅŸmiyor!');
            } else {
                this.setCustomValidity('');
            }
        });
    </script>
</body>
</html>

